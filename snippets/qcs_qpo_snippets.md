# Qlik Platform Operation snippets

These snippets can be copied into an Application Automation workspace using your system copy & paste.

## Add role to a user

This will maintain any existing roles that user has.

The automation will prompt for the tenant you wish to update the user on, then the automation will prompt for the user, and the roles you wish to add.

```

{"blocks":[{"id":"B8905015-5A6B-4E55-8BBE-25EAA9995149","type":"StartBlock","disabled":false,"name":"Start","displayName":"Start","comment":"","childId":"9A49B9AA-762F-48A0-B78A-62179936240A","inputs":[{"id":"run_mode","value":"manual","type":"select","structure":{}}],"settings":[],"collapsed":[{"name":"loop","isCollapsed":false}],"x":0,"y":0},{"id":"9A49B9AA-762F-48A0-B78A-62179936240A","type":"FormBlock","disabled":false,"name":"inputs","displayName":"Inputs","comment":"Specify the tenant","childId":"BD74BDF4-6741-4D16-9B41-0DA86A2A4A49","inputs":[],"settings":[{"id":"persist_data","value":"yes","type":"select","displayValue":"Yes","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":0,"y":120,"form":[{"id":"inputs-input-0","type":"input","label":"Tenant URL","order":0,"values":null,"options":[],"helpText":"URL of the Qlik Cloud tenant (e.g. mytenant.eu.qlikcloud.com)","isRequired":true}],"persistData":"yes"},{"id":"A1B6E4B8-8737-470E-B77C-F0355E3EC6A4","type":"EndpointBlock","disabled":false,"name":"listRoles","displayName":"Qlik Platform Operations - List Roles","comment":"Collect tenant roles and ids","childId":"161A90B4-B781-48A3-ADDB-10EEE5822543","inputs":[{"id":"bae46270-b76f-11ed-a52b-d71383a5b940","value":"{$.GetTenantNameAndRegion}","type":"string","structure":[]},{"id":"35bbb150-b77a-11ed-9a99-9b0cd6b2a9ab","value":null,"type":"string","structure":[]}],"settings":[{"id":"datasource","value":null,"type":"select","structure":[]},{"id":"maxitemcount","value":"","type":"string","structure":[]},{"id":"blendr_on_error","value":"stop","type":"select","structure":[]},{"id":"cache","value":"0","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":true}],"x":0,"y":840,"loopBlockId":null,"datasourcetype_guid":"c7e48240-e0f2-11ec-ada1-d5ef75014b77","endpoint_guid":"ba493570-b76f-11ed-b6ab-6fd465c15105","endpoint_role":"list"},{"id":"35C93190-3543-44CD-B6BA-92409974C81B","type":"FormBlock","disabled":false,"name":"inputs2","displayName":"Inputs 2","comment":"Select which user to update","childId":"A1B6E4B8-8737-470E-B77C-F0355E3EC6A4","inputs":[],"settings":[{"id":"persist_data","value":"no","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":0,"y":600,"form":[{"id":"inputs2-input-0","type":"select","label":"User to amend","order":0,"values":"{ $.transformList }","options":[],"helpText":"Select the user you wish to amend","isRequired":true}],"persistData":"no"},{"id":"BD74BDF4-6741-4D16-9B41-0DA86A2A4A49","type":"SnippetBlock","disabled":false,"name":"GetTenantNameAndRegion","displayName":"Qlik Platform Operations - Get Tenant Name And Region","comment":"","childId":"7110D824-F15D-45D1-ABCF-5E0662FFE953","inputs":[{"id":"575d1740-b1e2-11ed-958a-598edfec33b8","value":"{$.inputs.'Tenant URL'}","type":"string","structure":[]}],"settings":[{"id":"datasource","value":null,"type":"select","structure":[]},{"id":"blendr_on_error","value":"stop","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":-327,"y":157,"datasourcetype_guid":"c7e48240-e0f2-11ec-ada1-d5ef75014b77","snippet_guid":"bd5c1ce0-ad14-11ed-83f6-1d42e53790dd"},{"id":"161A90B4-B781-48A3-ADDB-10EEE5822543","type":"EndpointBlock","disabled":false,"name":"getUser","displayName":"Qlik Platform Operations - Get User","comment":"Retrieve the selected user record","childId":"FFB90886-559F-403B-85C7-A6BC23D962EC","inputs":[{"id":"dfb7c880-9caa-11ed-bae1-3325829d9725","value":"{ $.GetTenantNameAndRegion }","type":"string","structure":[]},{"id":"dfc724b0-9caa-11ed-8d7a-a5bc1a965960","value":"{ $.inputs2.'User to amend' }","type":"string","structure":[]}],"settings":[{"id":"datasource","value":null,"type":"select","structure":[]},{"id":"blendr_on_error","value":"stop","type":"select","structure":[]},{"id":"cache","value":"0","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":0,"y":520,"datasourcetype_guid":"c7e48240-e0f2-11ec-ada1-d5ef75014b77","endpoint_guid":"df9f1570-9caa-11ed-ac68-8ffd59764433","endpoint_role":"get"},{"id":"7110D824-F15D-45D1-ABCF-5E0662FFE953","type":"EndpointBlock","disabled":false,"name":"listUsers","displayName":"Qlik Platform Operations - List Users","comment":"","childId":"671897F0-9D6A-4E4E-AD8F-FDF96F4BF01F","inputs":[{"id":"447b9eb0-7634-11ed-a9df-a788128e422e","value":"{$.GetTenantNameAndRegion}","type":"string","structure":[]},{"id":"eb56ff20-9ca8-11ed-82cb-752b6b37b1a7","value":null,"type":"string","structure":[]}],"settings":[{"id":"datasource","value":null,"type":"select","structure":[]},{"id":"maxitemcount","value":"","type":"string","structure":[]},{"id":"blendr_on_error","value":"stop","type":"select","structure":[]},{"id":"cache","value":"0","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":true}],"x":-392,"y":105,"datasourcetype_guid":"c7e48240-e0f2-11ec-ada1-d5ef75014b77","endpoint_guid":"445157c0-7634-11ed-9b40-9720b0f37135","endpoint_role":"list"},{"id":"671897F0-9D6A-4E4E-AD8F-FDF96F4BF01F","type":"TransformListBlock","disabled":false,"name":"transformList","displayName":"Transform List","comment":"Format the user list for the input box","childId":"35C93190-3543-44CD-B6BA-92409974C81B","inputs":[{"id":"list","value":"{ $.listUsers }","type":"string","structure":[]},{"id":"mapping","value":[{"key":"id","value":"{$.transformList.item.id}"},{"key":"name","value":"{$.transformList.item.name} (sub: {$.transformList.item.subject} / email: {$.transformList.item.email} / id: {$.transformList.item.id})"}],"type":"object","mode":"keyValue","structure":[]}],"settings":[{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":true}],"x":-390,"y":480.181884765625},{"id":"239E980F-99AC-4DA2-89B0-4778DDFC2649","type":"FormBlock","disabled":false,"name":"inputs3","displayName":"Inputs 3","comment":"Select the roles to add","childId":"FDB44DB1-0A82-4C16-8E93-8355FE65CF82","inputs":[],"settings":[{"id":"persist_data","value":"no","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":531,"y":802,"form":[{"id":"inputs3-input-0","label":"Role to add","helpText":"This list shows the roles which can be added to this user","type":"multi_select","values":"{$.compareLists}","isRequired":true,"options":{},"order":0}],"persistData":"no"},{"id":"FFB90886-559F-403B-85C7-A6BC23D962EC","type":"CompareListsBlock","disabled":false,"name":"compareLists","displayName":"Compare Lists","comment":"Highlight which available roles the user doesn't yet have","childId":"239E980F-99AC-4DA2-89B0-4778DDFC2649","inputs":[{"id":"list1","value":"{$.listRoles}","type":"string","structure":[]},{"id":"list2","value":"{$.getUser.assignedRoles}","type":"string","structure":[]}],"settings":[{"id":"list1_unique_key","value":"id","type":"field","structure":[]},{"id":"list2_unique_key","value":"id","type":"field","structure":[]},{"id":"compare_mode","value":"diff","type":"select","structure":[]},{"id":"case_insensitive","value":null,"type":"checkbox","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":true}],"x":-382,"y":824.107421875},{"id":"0AB65223-869A-4C29-AFC6-35438B8849C0","type":"MergeListsBlock","disabled":false,"name":"mergeLists","displayName":"Merge Lists","comment":"Merge original roles with new roles","childId":"E520F666-190A-4FB7-A9F9-39F9C97C2B55","inputs":[{"id":"list1","value":"{$.transformList2}","type":"string","structure":[]},{"id":"list2","value":"{ $.getUser.assignedRoles[*] }","type":"string","structure":[]}],"settings":[{"id":"merge_strategy","value":"merge","type":"select","structure":[]},{"id":"list1_unique_key","value":"id","type":"field","structure":[]},{"id":"list2_unique_key","value":"id","type":"field","structure":[]},{"id":"on_duplicate_key","value":"merge","type":"select","displayValue":"Merge item from list 2 into item from list 1","structure":[]},{"id":"on_existing_item_key","value":"keep_list1","type":"select","structure":[]},{"id":"case_insensitive","value":null,"type":"checkbox","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":-408,"y":482.7509765625},{"id":"4207BA4B-05C1-4EC7-A9B1-869FAF91DBDA","type":"TransformListBlock","disabled":false,"name":"transformList2","displayName":"Transform List 2","comment":"Format the selected roles into an id: 9898 format","childId":"0AB65223-869A-4C29-AFC6-35438B8849C0","inputs":[{"id":"list","value":"{$.roles}","type":"string","structure":[]},{"id":"mapping","value":[{"key":"id","value":"{$.transformList2.item}"}],"type":"object","mode":"keyValue","structure":[]}],"settings":[{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":0,"y":1460},{"id":"FDB44DB1-0A82-4C16-8E93-8355FE65CF82","type":"ForEachBlock","disabled":false,"name":"loop","displayName":"Loop","comment":"Add the selected roles to a variable","childId":"4207BA4B-05C1-4EC7-A9B1-869FAF91DBDA","inputs":[{"id":"input","value":"{$.inputs3.'Role to add'.selected}","type":"string","structure":{}}],"settings":[{"id":"automations_censor_data","value":false,"type":"checkbox","structure":{}}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":-685,"y":1231,"loopBlockId":"3F0DF83E-F1A4-4114-9B29-1350A7425DA1"},{"id":"3F0DF83E-F1A4-4114-9B29-1350A7425DA1","type":"VariableBlock","disabled":false,"name":"roles","displayName":"Variable - roles","comment":"","childId":null,"inputs":[],"settings":[],"collapsed":[{"name":"loop","isCollapsed":false}],"x":-710,"y":1228,"variableGuid":"44557A7A-9C01-42ED-8A8C-36E0B7B8D53C","operations":[{"key":"B2CEA259-4B0B-457F-9530-D28076342DBB","id":"add_item","name":"Add item to { variable }","value":"{$.loop.item}"}]},{"id":"E520F666-190A-4FB7-A9F9-39F9C97C2B55","type":"TransformListBlock","disabled":false,"name":"transformList3","displayName":"Transform List 3","comment":"Tidy up list to ensure we just have id","childId":"EC4A8FB0-0537-456E-88D3-E77F5BBBF0E7","inputs":[{"id":"list","value":"{$.mergeLists}","type":"string","structure":[]},{"id":"mapping","value":[{"key":"id","value":"{$.transformList3.item.id}"}],"type":"object","mode":"keyValue","structure":[]}],"settings":[{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":250,"y":1460},{"id":"EC4A8FB0-0537-456E-88D3-E77F5BBBF0E7","type":"EndpointBlock","disabled":false,"name":"updateUser","displayName":"Qlik Platform Operations - Update User","comment":"","childId":null,"inputs":[{"id":"1275cc40-7d52-11ed-97f5-35480c4d133a","value":"{$.GetTenantNameAndRegion}","type":"string","structure":{}},{"id":"12813fb0-7d52-11ed-b2ac-cfed8b1c48f2","value":"{$.getUser.id}","type":"string","structure":{}},{"id":"55364350-7d52-11ed-889a-fb5bd7462102","value":null,"type":"string","structure":{}},{"id":"97589920-ceec-11ed-aede-33df8d01bc94","value":"{json: {$.transformList3}}","type":"string","structure":{}},{"id":"ae9800c0-ceec-11ed-bf0f-0510a2f5834b","value":null,"type":"string","structure":{}},{"id":"b440c910-ceec-11ed-b95b-c57e4f78d383","value":null,"type":"string","structure":{}},{"id":"b9f384a0-ceec-11ed-bd06-5f56dda1d03f","value":null,"type":"string","structure":{}},{"id":"bfb49fc0-ceec-11ed-9d75-f9d68f3e98a8","value":null,"type":"string","structure":{}}],"settings":[{"id":"datasource","value":null,"type":"select","structure":{}},{"id":"blendr_on_error","value":"stop","type":"select","structure":{}},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":{}}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":-258,"y":1759,"datasourcetype_guid":"c7e48240-e0f2-11ec-ada1-d5ef75014b77","endpoint_guid":"12491ca0-7d52-11ed-b5ad-e771eed0ab44","endpoint_role":"update"}],"variables":[{"guid":"44557A7A-9C01-42ED-8A8C-36E0B7B8D53C","name":"roles","type":"list"}]}

```